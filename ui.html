<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Inter, sans-serif;
      padding: 20px;
      margin: 0;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    label {
      font-size: 12px;
      font-weight: 500;
      color: #333;
    }
    
    select {
      padding: 8px;
      border: 1px solid #E6E6E6;
      border-radius: 6px;
      font-size: 14px;
    }
    
    button {
      background-color: #18A0FB;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    button:hover:not(:disabled) {
      background-color: #0D8DE3;
    }

    button:disabled {
      background-color: #E6E6E6;
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .status-preview {
      margin-top: 20px;
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .status-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .selection-info {
      font-size: 12px;
      color: #666;
      font-style: italic;
    }

    .color-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .status-options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 12px;
    }

    .status-option {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #666;
    }

    .divider {
      height: 1px;
      background-color: #E6E6E6;
      margin: 4px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-group">
      <label for="status">Page Status</label>
      <select id="status">
        <option value="">Select status...</option>
        <option value="Complete">Complete</option>
        <option value="In Progress">In Progress</option>
        <option value="Draft">Draft</option>
        <option value="Under Review">Under Review</option>
        <option value="Approved">Approved</option>
        <option class="divider" disabled>──────────</option>
        <option value="Section Title">Section Title</option>
        <option value="Sub Category">Sub Category</option>
      </select>

      <div class="status-options">
        <div class="status-option">
          <span class="color-dot" style="background-color: #4CAF50"></span>
          <span>Complete</span>
        </div>
        <div class="status-option">
          <span class="color-dot" style="background-color: #FFA500"></span>
          <span>In Progress</span>
        </div>
        <div class="status-option">
          <span class="color-dot" style="background-color: #FF0000"></span>
          <span>Draft</span>
        </div>
        <div class="status-option">
          <span class="color-dot" style="background-color: #2196F3"></span>
          <span>Under Review</span>
        </div>
        <div class="status-option">
          <span class="color-dot" style="background-color: #8BC34A"></span>
          <span>Approved</span>
        </div>
        <div class="divider"></div>
        <div class="status-option">
          <span style="font-family: monospace">↪</span>
          <span>Section Title</span>
        </div>
        <div class="status-option">
          <span style="font-family: monospace; margin-left: 8px">↪</span>
          <span>Sub Category</span>
        </div>
      </div>
    </div>
    
    <button id="apply" disabled>Apply Status</button>
    
    <div id="preview" class="status-preview">
      <div class="status-info">
        Current page: <span class="color-dot"></span> <span id="currentStatus"></span>
      </div>
      <div id="selectionInfo" class="selection-info"></div>
    </div>
  </div>

  <script>
    let currentStatus = '';
    let selectedPagesCount = 1;
    let hasUnassignedPages = false;
    const applyButton = document.getElementById('apply');
    const statusSelect = document.getElementById('status');
    const selectionInfo = document.getElementById('selectionInfo');

    function updateSelectionInfo() {
      if (selectedPagesCount > 1) {
        selectionInfo.textContent = `${selectedPagesCount} unassigned pages selected - Status will be applied to all unassigned pages`;
      } else if (selectedPagesCount === 1 && hasUnassignedPages) {
        selectionInfo.textContent = 'Current page is unassigned';
      } else {
        selectionInfo.textContent = '';
      }
    }

    // Function to update button state
    function updateButtonState() {
      const selectedStatus = statusSelect.value;
      // Enable button if:
      // 1. A status is selected AND
      // 2. There are unassigned pages selected
      applyButton.disabled = !selectedStatus || !hasUnassignedPages;
    }

    // Listen for status changes
    statusSelect.addEventListener('change', updateButtonState);

    document.getElementById('apply').onclick = () => {
      const status = statusSelect.value;
      currentStatus = status;
      updateButtonState();
      
      parent.postMessage({
        pluginMessage: {
          type: 'update-page-status',
          status
        }
      }, '*');
    };
    
    // Request current page status when UI loads
    parent.postMessage({
      pluginMessage: {
        type: 'get-current-page-status'
      }
    }, '*');
    
    // Listen for messages from the plugin code
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      
      if (msg.type === 'current-page-status' || msg.type === 'selection-changed') {
        currentStatus = msg.status;
        statusSelect.value = msg.status;
        document.getElementById('currentStatus').textContent = msg.status || 'No status set';
        selectedPagesCount = msg.selectedPages;
        hasUnassignedPages = msg.hasUnassignedPages;
        updateSelectionInfo();
        updateButtonState();
      }
      
      if (msg.type === 'status-updated') {
        currentStatus = msg.status;
        document.getElementById('currentStatus').textContent = msg.status;
        selectedPagesCount = msg.affectedPages;
        hasUnassignedPages = msg.hasUnassignedPages;
        updateSelectionInfo();
        updateButtonState();
      }
    };
  </script>
</body>
</html> 